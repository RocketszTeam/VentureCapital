var sendphone,is_id_check=!1,is_phone_check=!1,phone_reg=/^09[0-9]{8}$/,id_reg=/^[a-zA-Z0-9]{4,10}$/,pass_reg=/^(?!([^a-zA-Z]+|\D+)$)[a-zA-Z0-9]{6,13}$/,rtimer=null,t=30,limti_t=t;function submitCheck(){if(0<$(".agree:checked").length){if($("#agree-error").hide(),$("#signForm").valid()){var e=$(window).width()/2-64;$.blockUI({message:'<img src="'+ASSETS_URL+'/www/images/009.gif" >',baseZ:2e3,css:{width:"128px",left:e}}),$.ajax({type:"POST",url:CI_URL+"Manger/register_do.aspx",cache:!1,dataType:"json",data:$("#signForm").serialize()}).done(function(e){$.unblockUI(),"Y"==e.RntCode?location.href=CI_URL+"Welcome.aspx":(alert(e.Msg),changeChkImg("reg_checknum","regImg"))})}}else $("#agree-error").show()}function getPhoneCode(){$("#smsBTN").unbind("click"),$("#smsBTN").html("發送中..."),$.ajax({type:"POST",url:CI_URL+"Manger/ajax_phonecode.aspx",cache:!1,async:!1,dataType:"json",data:{phone:$("#phone").val(),sms_token:$("#sms_token").val()}}).done(function(e){"Y"==e.RntCode?(alert("簡訊驗證碼已發送至手機"),showTime(),limti_t=t,$("#smsBTN").unbind("click")):"W"==e.RntCode?(alert("簡訊發送失敗，Error:"+e.Msg),$("#smsBTN").unbind("click"),limti_t=t,showTime()):($("#smsBTN").bind("click",getPhoneCode),$("#smsBTN").html("發送簡訊驗證碼"),alert("簡訊發送失敗，Error:"+e.Msg))})}function showTime(){rtimer=setTimeout("showTime()",1e3);var e=(limti_t-=1)+"秒後重新發送";$("#smsBTN").html(e),0==limti_t&&(clearTimeout(rtimer),$("#smsBTN").html("發送簡訊驗證碼"),$("#smsBTN").bind("click",getPhoneCode),$("#smsBTN").attr("disabled",!1),limti_t=t)}$(function(){$("#squaredThree").click(function(){$(this).prop("checked")?$("#agree-error").hide():$("#agree-error").show()}),jQuery.validator.addMethod("AccountFormat",function(e,r){return id_reg.test(e)}),$("#u_id").addClass("AccountFormat"),jQuery.validator.addMethod("idCheck",function(e,r){var a=!1;return $.ajax({type:"POST",url:CI_URL+"Manger/ajax_chkid.aspx",cache:!1,async:!1,dataType:"json",data:{u_id:$("#u_id").val()}}).done(function(e){a=is_id_check="Y"==e.RntCode}).error(function(e,r,a){console.log(e),console.log(r),console.log(a)}),a}),$("#u_id").addClass("idCheck"),jQuery.validator.addMethod("PasswordFormat",function(e,r){return pass_reg.test(e)}),$("#u_password").addClass("PasswordFormat"),jQuery.validator.addMethod("upAccountCheck",function(e,r){var a=!0;return""!=e&&$.ajax({type:"POST",url:CI_URL+"Manger/ajax_chkupaccount.aspx",cache:!1,async:!1,dataType:"json",data:{up_account:$("#up_account").val()}}).done(function(e){a="Y"==e.RntCode}),a}),jQuery.validator.addMethod("phoneFormat",function(e,r){return phone_reg.test(e)}),$("#phone").addClass("phoneFormat"),$("#smsBTN").bind("click",getPhoneCode),$("#signForm").validate({onkeyup:!1,errorClass:"help-block alert-danger",errorElement:"div",errorPlacement:function(e,r){0<$(r).parents(".inputR").length?r.parents(".inputR").after(e):r.parent().append(e)},highlight:function(e,r,a){$(e).removeClass("alert alert-warning")},unhighlight:function(e,r,a){$(e).removeClass("alert alert-warning")},rules:{u_id:{required:!0,AccountFormat:!0,idCheck:!0},u_password:{required:!0,PasswordFormat:!0},u_password2:{required:!0,equalTo:"#u_password"},u_name:{required:!0},phone:{required:!0,phoneFormat:!0},sms_code:{required:!0},checknum:{required:!0},squaredThree:{required:!0}},messages:{u_id:{required:"請輸入您的帳號",AccountFormat:"請輸入4~10個英文或數字組合",idCheck:"會員帳號已被註冊"},u_password:{required:"請輸入您的密碼",PasswordFormat:"請輸入6~13碼英文數字混合"},u_password2:{required:"請再次輸入密碼",equalTo:"會員密碼與確認密碼不同"},u_name:{required:"請輸入真實姓名"},phone:{required:"請輸入您的手機",phoneFormat:"手機格式錯誤"},sms_code:{required:"請輸入手機驗證碼"},checknum:{required:"請輸入驗證碼"},squaredThree:{required:"請輸入驗證碼"}}}),$("#submitBtn").bind("click",submitCheck)});