var sendphone,phone_reg=/^09[0-9]{8}$/,rtimer=null,t=30,limti_t=t;function submitCheck(){if($("#signForm").valid()){var e=$(window).width()/2-64;$.blockUI({message:'<img src="'+ASSETS_URL+'/www/images/009.gif" >',baseZ:2e3,css:{width:"128px",left:e}}),$.ajax({type:"POST",url:CI_URL+"Forget/forget_do.aspx",cache:!1,dataType:"json",data:$("#signForm").serialize()}).done(function(e){$.unblockUI(),"Y"==e.RntCode?alert(e.Msg):(alert(e.Msg),changeChkImg("forget_checknum","regImg"))})}}function getPhoneCode(){is_phone_check?($("#smsBTN").unbind("click"),$("#smsBTN").html("發送中..."),$.ajax({type:"POST",url:CI_URL+"Manger/ajax_phonecode.aspx",cache:!1,async:!1,dataType:"json",data:{phone:$("#phone").val(),sms_token:$("#sms_token").val()}}).done(function(e){"Y"==e.RntCode?(alert("簡訊驗證碼已發送至手機"),showTime(),limti_t=t,$("#smsBTN").unbind("click")):"W"==e.RntCode?(alert("簡訊發送失敗，Error:"+e.Msg),$("#smsBTN").unbind("click"),limti_t=t,showTime()):($("#smsBTN").bind("click",getPhoneCode),$("#smsBTN").html("發送認證簡訊"),alert("簡訊發送失敗，Error:"+e.Msg))})):alert("請檢查您的手機！")}function showTime(){rtimer=setTimeout("showTime()",1e3);var e=(limti_t-=1)+"秒後重新發送";$("#smsBTN").html(e),0==limti_t&&(clearTimeout(rtimer),$("#smsBTN").html("發送認證簡訊"),$("#smsBTN").bind("click",getPhoneCode),$("#smsBTN").attr("disabled",!1),limti_t=t)}$(function(){jQuery.validator.addMethod("phoneFormat",function(e,t){return phone_reg.test(e)}),$("#phone").addClass("phoneFormat"),$("#signForm").validate({onkeyup:!1,errorClass:"text-danger",errorElement:"span",errorPlacement:function(e,t){0<t.parents(".inputR").length?t.parents(".inputR").after(e):t.parent().append(e)},highlight:function(e,t,n){$(e).removeClass("text-danger")},unhighlight:function(e,t,n){$(e).removeClass("text-danger")},rules:{u_id:{required:!0},phone:{required:!0,phoneFormat:!0},forget_checknum:{required:!0}},messages:{u_id:{required:"請輸入您的帳號"},phone:{required:"請輸入您的手機",phoneFormat:"手機格式錯誤"},forget_checknum:{required:"請輸入驗證碼"}}}),$("#submitBtn").bind("click",submitCheck)});